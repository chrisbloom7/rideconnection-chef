<VirtualHost *:80>
  ServerName <%= @params[:server_name] %>
  ServerAlias <% @params[:server_aliases].each do |a| %><%= a %> <% end %>
  DocumentRoot <%= @params[:docroot] %>

  RailsBaseURI /
  RailsEnv <%= @params[:rails_env] %>

  <Directory <%= @params[:docroot] %>>
    Options FollowSymLinks
    AllowOverride None
    Order allow,deny
    Allow from all
  </Directory>

  LogLevel info
  ErrorLog <%= node['apache']['log_dir'] %>/<%= @params[:name] %>-error.log
  CustomLog <%= node['apache']['log_dir'] %>/<%= @params[:name] %>-access.log combined

  RewriteEngine On
  RewriteLog <%= node['apache']['log_dir'] %>/<%= @application_name %>-rewrite.log
  RewriteLogLevel 0
  # Canonical host
  RewriteCond %{HTTP_HOST}   !^<%= @params[:server_name] %> [NC]
  RewriteCond %{HTTP_HOST}   !^$
  RewriteRule ^/(.*)$        http://<%= @params[:server_name] %>/$1 [L,R=301]

  RewriteCond %{DOCUMENT_ROOT}/system/maintenance.html -f
  RewriteCond %{SCRIPT_FILENAME} !maintenance.html
  RewriteRule ^.*$ /system/maintenance.html [L]
</VirtualHost>





PassengerMaxPoolSize <%= node[:passenger][:max_pool_size] %>
#
# Single project
#
<VirtualHost *:80>
   ServerName apps2.rideconnection.org
   # !!! Be sure to point DocumentRoot to 'public'!
   DocumentRoot #{node[:public_directory]}
   <Directory #{node[:public_directory]}>
      # This relaxes Apache security settings.
      AllowOverride all
      # MultiViews must be turned off.
      Options -MultiViews
   </Directory>
</VirtualHost>

<VirtualHost *:443>
  ServerName ch.rideconnection.org
  DocumentRoot #{node[:public_directory]}
  <Directory #{node[:public_directory]}>
    AllowOverride all
    Options -MultiViews
  </Directory>

  SSLEngine on
  SSLOptions +StrictRequire
  SSLCertificateFile #{node[:ssl_cert]} 
  SSLCertificateKeyFile #{node[:ssl_cert_key]} 
</VirtualHost>

#
# Multiple projects 
#
# Link your app from /srv/<app>/current/public to /var/www/<app>
# EG: ln -s /srv/pub.co/current/public /var/www/pub.co
#
# <VirtualHost *:80>
#         ServerName localhost
#         DocumentRoot /var/www
#         RailsBaseURI /<app1>
#         RailsBaseURI /<app2>
#         RailsBaseURI /<app3>
# </VirtualHost>
